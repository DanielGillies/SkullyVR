<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>SKULLY Mobile Experience</title>
    <link rel="stylesheet" type="text/css" href="css/main.css">
    <link rel="stylesheet" type="text/css" href="css/mobile.css">
</head>

<body>
    <!--<script src="//cdnjs.cloudflare.com/ajax/libs/annyang/2.1.0/annyang.min.js"></script>-->
    <script src="js/three.min.js"></script>
    <script src="js/DeviceOrientationController.js"></script>
    <script src="js/StereoEffect.js"></script>
    <video id="video" muted preload loop style="display:none">
        <source type="video/mp4">
    </video>
    <div class="banner" id="b1">
        <p>60 MPH</p>
    </div>
    <div class="progress-bar">
        <div id="positive" class="bar positive">
            <span>0%</span>
        </div>
        <div id="negative"class="bar negative">
            <span>0%</span>
        </div>
    </div>
    <script src="js/getVid.js"></script>
    <script>
    var camera, camera2, scene, renderer, renderer2;
    var geometry, material, mesh, texture, skybox;
    var controls, controls2;

    var loader = new THREE.TextureLoader();

    var controlsEnabled = true;

    // document.addEventListener("touchstart", function() {
    //     if (!inited) {
    //         inited = true;
    //         console.log("TOUCHED")
    //         init();
    //         animate();
    //     }
    // })

    // document.addEventListener("click", function() {
    //     if (!inited) {
    //         inited = true;
    //         console.log("CLICKED")
    //         init();
    //         animate();
    //     }
    // }, false)

    function init() {

        console.log("FFFFFFF");

        camera = new THREE.PerspectiveCamera(90, window.innerWidth / window.innerHeight, 1, 1000);
        camera2 = new THREE.PerspectiveCamera(120, window.innerWidth / window.innerHeight, 1, 1000);

        scene = new THREE.Scene();

        renderer = new THREE.WebGLRenderer();
        renderer.setPixelRatio(window.devicePixelRatio);
        renderer.setSize(window.innerWidth, window.innerHeight);
        document.body.appendChild(renderer.domElement);

        renderer2 = new THREE.WebGLRenderer();
        renderer2.setPixelRatio(window.devicePixelRatio);
        renderer2.setSize(120, 70);
        document.body.appendChild(renderer2.domElement);


        var canvases = document.getElementsByTagName("canvas");

        for (var j = 0; j < canvases.length; j++) {
            if (canvases[j].id === "")
                canvases[j].setAttribute("id", "canvas" + (j));
        }

        fullscreen();

        controls = new DeviceOrientationController(camera, renderer.domElement);
        controls2 = new DeviceOrientationController(camera2, renderer2.domElement);
        controls.connect();
        controls2.connect();

        geometry = new THREE.SphereGeometry(100, 60, 40);

        var video = document.getElementById("video")
        video.play();
        var texture = new THREE.VideoTexture(video);
        texture.minFilter = THREE.NearestFilter;

        material = new THREE.MeshBasicMaterial({
            map: texture
        });


        skyBox = new THREE.Mesh(geometry, material);
        skyBox.scale.set(-1, 1, 1);
        skyBox.rotation.y = -Math.PI / 2;
        scene.add(skyBox);

        window.addEventListener('resize', onWindowResize, false);

    }

    function onWindowResize() {

        camera.aspect = window.innerWidth / window.innerHeight;
        camera.updateProjectionMatrix();
        camera2.updateProjectionMatrix();

        renderer.setSize(window.innerWidth, window.innerHeight);
        // renderer2.setSize(120, 70);

        // effect.setSize(window.innerWidth, window.innerHeight);

    }

    function animate() {

        controls.update();
        controls2.updateReverse();

        requestAnimationFrame(animate);

        renderer.render(scene, camera);
        renderer2.render(scene, camera2);
    }

    function fullscreen() {
        container = document.body;
        if (container.requestFullscreen) {
            container.requestFullscreen();
        } else if (container.msRequestFullscreen) {
            container.msRequestFullscreen();
        } else if (container.mozRequestFullScreen) {
            container.mozRequestFullScreen();
        } else if (container.webkitRequestFullscreen) {
            container.webkitRequestFullscreen();
        }
    }
    </script>
</body>

</html>
